<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styleS.css">

</head>

<body style="padding-top: 100px;">
    <nav class="navbar navbar-expand-sm bg-light navbar-light fixed-top ">
        <a class="navbar-brand" href="home.html">The secret garden</a>
        <img src="images/logo1.jpg" class="rounded-circle" height="50px" width="50px">

        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="home.html">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " href="product.html">Our Products</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="search.html">Search Product</a>
            </li>
            <li class="nav-item" active>
                <a class="nav-link" href="buy.html">Buy</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="cart.html">MyCart</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="login.html">logout</a>
            </li>
        </ul>
    </nav>
    <div class="m">
        Enter Plant Name <input type="text" id="tt" onchange="getprice()">
        Price <label id="priceLabel"></label><br><br>

        Enter Quantity <input type="number" id="num" size="5" value="1">
        <button onclick="add()">Buy</button>

        <div id="mess"></div><br>
        <table border="1" width="70%" id="tbl"></table>
        <button onclick="checkout()">Check out</button>
    </div>


    <script>
        let pp = "";
        let cartItems = [];

        async function getprice() {
            let response = await fetch("plants.json");
            let data = await response.json();
            pp = "no plant was found";

            for (let i = 0; i < data.length; i++) {
                if (document.getElementById("tt").value.toLowerCase() == data[i].itemname.toLowerCase()) {
                    pp = data[i].price;
                }
            }
            document.getElementById("priceLabel").innerHTML = pp;
        }

        function add() {
            let item = {
                name: document.getElementById("tt").value,
                price: parseFloat(pp),
                quant: parseInt(document.getElementById("num").value),
            };

            cartItems.push(item);
            display();


            document.getElementById("priceLabel").innerHTML = "";
            document.getElementById("tt").value = "";
            document.getElementById("num").value = 1;

        }

        function display() {
            let ta = "My Shopping Cart<tr><th>Name</th><th>Price</th><th>Quantity</th><th>Delete</th></tr>";

            for (let i = 0; i < cartItems.length; i++) {
                ta += "<tr><td>" + cartItems[i].name + "</td><td>" + cartItems[i].price + "</td><td>" + cartItems[i].quant +
                    "</td><td><button class='delBtn' onclick='del(" + i + ")'>Delete</button></td></tr>";
            }

            document.getElementById("tbl").innerHTML = ta;
        }

        function del(index) {
            cartItems.splice(index, 1);
            display();
        }

        function checkout() {
            let tot = 0;

            for (i = 0; i < cartItems.length; i++) {
                tot += cartItems[i].price * cartItems[i].quant;
            }

            localStorage.setItem("total", tot);
            let num = cartItems.length;

            alert("Thank You! You selected " + num + " items. You must pay SAR " + tot);
        }
    </script>
</body>

</html>